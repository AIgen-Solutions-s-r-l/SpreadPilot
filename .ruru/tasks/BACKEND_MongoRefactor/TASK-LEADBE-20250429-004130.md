+++
id = "TASK-LEADBE-20250429-004130"
title = "Coordinate Backend Refactoring for MongoDB Integration"
status = "üü° To Do"
type = "üåü Feature"
priority = "‚ñ∂Ô∏è High" # High priority as it's a core architectural change
created_date = "2025-04-29"
updated_date = "2025-04-29"
# due_date = ""
# estimated_effort = ""
assigned_to = "lead-backend"
# reporter = "roo-commander"
parent_task = "TASK-CMD-20250429-003830" # Commander's coordinating task
depends_on = ["TASK-COMPOSE-20250429-003840"] # Must happen after Docker setup
related_docs = [".ruru/decisions/20250429-adopt-mongodb-primary-database.md"]
tags = ["backend", "refactor", "mongodb", "database", "coordination", "admin-api", "data-access"]
template_schema_doc = ".ruru/templates/toml-md/01_mdtm_feature.README.md"
# ai_prompt_log = """"""
# review_checklist = []
# reviewed_by = ""
# key_learnings = ""
+++

# Coordinate Backend Refactoring for MongoDB Integration

## Description ‚úçÔ∏è

*   **What is this feature?** Coordinate the necessary changes across backend services (starting with `admin-api`) to replace existing data persistence logic (likely Firestore, see `admin-api/app/db/firestore.py`) with MongoDB. Utilize the newly available Dockerized MongoDB instance (`mongodb` service in `docker-compose.yml`).
*   **Why is it needed?** To implement the architectural decision documented in ADR-20250429-MONGO, moving away from potential vendor lock-in and enabling flexible database deployment.
*   **Scope:** Oversee the refactoring of data access layers, configuration updates, dependency management, and initial testing for MongoDB integration in backend services. Ensure the implementation is adaptable for future connections to external MongoDB clusters via configuration.
*   **Links:**
    *   ADR: `.ruru/decisions/20250429-adopt-mongodb-primary-database.md`
    *   Completed Docker Task: `TASK-COMPOSE-20250429-003840`

## Acceptance Criteria ‚úÖ

*   - [ ] Backend Lead coordinates the delegation of specific refactoring tasks to relevant specialists (e.g., `data-mongo`, `dev-python`, `framework-fastapi`).
*   - [ ] Data access layer in `admin-api` (and potentially `spreadpilot-core` if shared logic exists) is refactored to use an appropriate MongoDB client library (e.g., `pymongo`, `motor`).
*   - [ ] Configuration (e.g., `admin-api/app/core/config.py`) is updated to read MongoDB connection details (URI, DB name, credentials) from environment variables.
*   - [ ] Existing Firestore code (`admin-api/app/db/firestore.py`) is removed or clearly marked as deprecated.
*   - [ ] Required MongoDB client libraries are added to relevant requirements files (e.g., `admin-api/requirements.in`) and installed.
*   - [ ] Basic CRUD operations for key models (start with Followers in `admin-api`) function correctly against the MongoDB database running in Docker.
*   - [ ] Relevant integration tests (e.g., in `tests/integration/`) are updated or created to verify MongoDB interactions, potentially requiring adjustments to test fixtures (`conftest.py`).

## Implementation Notes / Sub-Tasks üìù

*   Prioritize refactoring the `admin-api` service first.
*   Analyze `admin-api` (FastAPI) to determine if an asynchronous driver like `motor` is more appropriate than synchronous `pymongo`.
*   Delegate specific coding tasks (e.g., creating DB connection logic, refactoring service layers, updating models/schemas) to specialists like `data-mongo` or `dev-python`.
*   Ensure the connection logic handles both the Docker service name (`mongodb`) and potentially full external URIs based on environment variables.
*   Coordinate with `lead-qa` if necessary for testing strategy updates.

## Diagrams üìä (Optional)

*   N/A

## AI Prompt Log ü§ñ (Optional)

*   N/A

## Review Notes üëÄ (For Reviewer)

*   Verify adaptability of connection logic.
*   Check removal/deprecation of old Firestore code.
*   Ensure tests cover MongoDB interactions.

## Key Learnings üí° (Optional - Fill upon completion)

*