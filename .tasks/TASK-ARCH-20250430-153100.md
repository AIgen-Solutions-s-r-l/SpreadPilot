+++
# --- Basic Metadata ---
id = "TASK-ARCH-20250430-153100"
title = "Analyze Firestore Usage & Plan MongoDB Migration"
status = "üü¢ Done" # Analysis complete, no migration needed
type = "üèóÔ∏è Planning"
created_date = "2025-04-30"
updated_date = "2025-04-30" # Keep original updated date, or update? Let's update.
# --- Assignment & Coordination ---
assigned_to = "core-architect"
coordinator = "TASK-CMD-20250430-153000" # Assuming this is the Commander's coordinating task ID for this session
# --- Details & Context ---
priority = "üî¥ Critical"
estimated_effort = "Medium" # Requires thorough code review
related_docs = [
    "README.md",
    "docs/01-system-architecture.md" # May need update later
]
tags = ["refactor", "database", "firestore", "mongodb", "analysis", "planning", "architecture", "critical"]
# --- Template Specific ---
# (Add any fields specific to a planning template if applicable)
+++

# Analyze Firestore Usage & Plan MongoDB Migration

**Objective:** Prepare for the complete removal of Google Firestore by identifying all dependencies and creating a detailed migration plan to MongoDB.

**Background:** The project currently uses Google Firestore, but a strategic decision has been made to migrate entirely to MongoDB for all services. This is a critical refactoring task requiring careful planning.

**Description:**
This task involves a thorough analysis of the entire codebase (`admin_api`, `alert_router`, `report_worker`, `trading-bot`, `spreadpilot-core`, `frontend`) to:
1.  Identify every instance of Firestore client initialization and usage.
2.  Document the current data models stored in Firestore.
3.  Design equivalent schemas for MongoDB.
4.  Outline a strategy for data migration (if necessary).
5.  Propose a phased plan for refactoring each service and the frontend.

**Acceptance Criteria:**
*   A comprehensive list of all files and specific code sections interacting with Firestore is documented in the planning file.
*   Proposed MongoDB schema designs corresponding to existing Firestore data structures are defined in the planning file.
*   A high-level data migration strategy (addressing potential downtime, data transformation needs) is outlined in the planning file.
*   A recommended sequence for refactoring services is included in the planning file.
*   A detailed planning document is created at: `.planning/firestore-to-mongo-migration-plan.md`.
*   An Architecture Decision Record (ADR) is created at: `.decisions/20250430-switch-firestore-to-mongodb.md` (or similar date), documenting the decision and high-level plan.

**Checklist:**
- [‚úÖ] Search codebase for Firestore client initialization and usage patterns (e.g., `firebase_admin`, `firestore.client()`, `.collection()`, `.document()`, `.get()`, `.set()`, `.update()`, `.delete()`, relevant environment variables). (Completed - No usage found)
- [‚úÖ] List all affected files and specific code locations within the planning document. (Completed - Documented in `.planning/firestore-to-mongo-migration-plan.md` that none were found)
- [‚úÖ] Analyze and document the data models currently stored in Firestore within the planning document. (Completed - Documented that none exist)
- [‚úÖ] Design equivalent MongoDB schemas (considering document structure, relationships, potential indexing needs) and document them. (Completed - Documented as not applicable)
- [‚úÖ] Outline data migration steps, tools, and considerations (if data migration is required). (Completed - Documented as not applicable)
- [‚úÖ] Define the recommended refactoring sequence for services and frontend components. (Completed - Documented as not applicable)
- [‚úÖ] Create and populate the planning document: `.planning/firestore-to-mongo-migration-plan.md`. (Completed)
- [‚úÖ] Create and populate the ADR: `.decisions/20250430-switch-firestore-to-mongodb.md`. (Completed)
- [‚úÖ] Update this task status to 'Done' upon completion. (Completed via this update)

**Notes:**
*   Pay close attention to configuration files and environment variables related to Firestore credentials.
*   Consider any potential impact on existing integration tests.