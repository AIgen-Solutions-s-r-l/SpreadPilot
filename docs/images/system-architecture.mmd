graph TD
    %% Core Services
    TradingBot[Trading Bot] --> OrderExecutor[Order Executor]
    OrderExecutor --> GatewayManager[Gateway Manager]
    GatewayManager --> IBGateway1[IB Gateway: Follower 1]
    GatewayManager --> IBGateway2[IB Gateway: Follower 2]
    GatewayManager --> IBGatewayN[IB Gateway: Follower N]
    TradingBot --> MongoDB[(MongoDB)]
    TradingBot --> GoogleSheets[(Google Sheets)]
    OrderExecutor --> PubSubAlerts[Pub/Sub: alerts]
    
    Watchdog[Watchdog] --> TradingBot
    Watchdog --> GatewayManager
    Watchdog --> MongoDB
    Watchdog --> PubSubAlerts
    
    AdminAPI[Admin API] --> TradingBot
    AdminAPI --> GatewayManager
    AdminAPI --> MongoDB
    
    ReportWorker[Report Worker] --> MongoDB
    ReportWorker --> SendGrid[(SendGrid)]
    PubSubReports[Pub/Sub: reports] --> ReportWorker
    
    AlertRouter[Alert Router] --> Telegram[(Telegram)]
    AlertRouter --> SendGrid
    PubSubAlerts --> AlertRouter
    
    Frontend[Frontend] --> AdminAPI
    
    %% Infrastructure
    CloudScheduler[Cloud Scheduler] --> PubSubReports
    
    %% Observability
    OTel[OpenTelemetry] --> Prometheus[(Prometheus)]
    OTel --> CloudMonitoring[(Cloud Monitoring)]
    Prometheus --> Grafana[Grafana]
    
    %% Service connections to observability
    TradingBot -.-> OTel
    OrderExecutor -.-> OTel
    GatewayManager -.-> OTel
    Watchdog -.-> OTel
    AdminAPI -.-> OTel
    ReportWorker -.-> OTel
    AlertRouter -.-> OTel
    
    %% Styling
    classDef coreService fill:#4285F4,stroke:#2A56C6,color:white
    classDef infrastructure fill:#34A853,stroke:#1E8E3E,color:white
    classDef observability fill:#FBBC04,stroke:#EA8600,color:white
    classDef database fill:#EA4335,stroke:#C5221F,color:white
    classDef external fill:#9AA0A6,stroke:#80868B,color:white
    
    class TradingBot,Watchdog,AdminAPI,ReportWorker,AlertRouter,Frontend,GatewayManager,OrderExecutor coreService
    class IBGateway1,IBGateway2,IBGatewayN,CloudScheduler infrastructure
    class OTel,Prometheus,Grafana,CloudMonitoring observability
    class MongoDB,PubSubAlerts,PubSubReports database
    class GoogleSheets,SendGrid,Telegram external
